<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cep.project.service.impl.ProjectMapper">

	<resultMap id="project" type="com.cep.project.vo.ProjectVO">
		<result property="pjKey" column="PJ_KEY"/>
		<result property="acKey" column="AC_KEY"/>
		<result property="acDirectorKey" column="AC_DIRECTOR_KEY" />
		<result property="pjNm" column="PJ_NM"/>
		<result property="pjStartDt" column="PJ_START_DT"/>
		<result property="pjInspectDt" column="PJ_INSPECT_DT" />
		<result property="pjEndDt" column="PJ_END_DT"/>
		<result property="pjStatusCd" column="PJ_STATUS_CD"/>
		<result property="pjSaleEmpKey" column="PJ_SALE_EMP_KEY"/>
		<result property="pjSupportEmpKey" column="PJ_SUPPORT_EMP_KEY"/>
		<result property="remark" column="REMARK" />
		<result property="finishRemark" column="FINISH_REMARK" />
		<result property="deleteYn" column="DELETE_YN" />
		<result property="regEmpKey" column="REG_EMP_KEY" />
		<result property="spKey" column="SP_KEY" />
	</resultMap>

	<select id="selectProjectList" parameterType="projectVO" resultMap="project">

			SELECT
				PJ_KEY
				, (SELECT a.AC_NM FROM CMM_ACCOUNT_TB a WHERE a.AC_KEY = PJ_MAIN_TB.AC_KEY) AS acKey
				, PJ_NM
				, PJ_START_DT
				, PJ_END_DT
				, (SELECT c.CD_NM FROM CMM_CODE_MNG_TB c WHERE c.CD_KEY = PJ_MAIN_TB.PJ_STATUS_CD) AS pjStatusCd
				, (SELECT e.EMP_NM FROM CMM_EMPLOYEE_TB e WHERE e.EMP_KEY = PJ_MAIN_TB.PJ_SALE_EMP_KEY) AS pjSaleEmpKey
			FROM PJ_MAIN_TB
			WHERE 1=1
			<if test="searchFromDt != null and searchFromDt != ''">
					AND DATE_FORMAT(PJ_START_DT, '%Y-%m-%d') >= #{searchFromDt}
			</if>
			<if test="searchToDt != null and searchToDt != ''">
				<![CDATA[
					AND DATE_FORMAT(PJ_END_DT, '%Y-%m-%d') <= #{searchToDt}
				]]>
			</if> 
			<if test="searchKeyword != null and searchKeyword != ''">
					AND PJ_NM LIKE CONCAT('%' , #{searchKeyword}, '%')
			</if> 
	</select>

	<select id="selectProjectListTotCnt" parameterType="searchVO" resultType="int">

			SELECT COUNT(*)
			FROM PJ_MAIN_TB
			WHERE 1=1
			<!-- <if test="searchKeyword != null and searchKeyword != ''">
		        <choose>
		            <when test="searchCondition == 0">
						AND	USERNAME LIKE CONCAT('%' , #{searchKeyword}, '%')
					</when>
		            <when test="searchCondition == 1">
						AND	TITLE LIKE CONCAT('%' , #{searchKeyword}, '%')
					</when>
				</choose>
			</if> -->
	</select>

	<select id="selectProjectDetail" parameterType="String" resultType="egovMap">
		SELECT
			PJ.PJ_KEY
			, CA.AC_NM
			, CONCAT(AD.AC_DIRECTOR_POSITION_NM , ' / ' , AD.AC_DIRECTOR_MB_NUM , ' / ' , AD.AC_DIRECTOR_EMAIL) AS AC_DIRECTOR_INFO
			, PJ.AC_KEY
			, PJ.AC_DIRECTOR_KEY
			, AD.AC_DIRECTOR_NM
			, PJ.PJ_NM
			, PJ.PJ_START_DT
			, PJ.PJ_END_DT
			, PJ.PJ_SALE_EMP_KEY
			, CE.EMP_NM
			, PJ.PJ_SUPPORT_EMP_KEY
			, PJ.REMARK
			, PJ.PJ_INSPECT_DT
			, PJ.FINISH_REMARK
			, PJ.SP_KEY
			, PJ.PJ_LOSE_CAUSE
			, PJ.PJ_SJ_YN
			, (SELECT CT.CT_DT FROM PJ_CONTRACT_TB CT, PJ_MAIN_TB PJ1 WHERE CT.PJ_KEY = PJ1.PJ_KEY AND PJ1.PJ_KEY=#{pjKey} AND CT.DELETE_YN='N') AS CT_DT
		FROM PJ_MAIN_TB PJ, CMM_ACCOUNT_TB CA, CMM_ACCOUNT_DIRECTOR_TB AD, CMM_EMPLOYEE_TB CE
		WHERE PJ_KEY=#{pjKey}
			AND PJ.AC_KEY = CA.AC_KEY		
		  	AND PJ.AC_KEY = AD.AC_KEY			
		  	AND PJ.AC_DIRECTOR_KEY = AD.AC_DIRECTOR_KEY
		  	AND PJ.PJ_SALE_EMP_KEY = CE.EMP_KEY
		  	AND PJ.DELETE_YN='N'
	</select>
	
	<update id="updateStatusCd" parameterType="String">
		UPDATE PJ_MAIN_TB
		SET PJ_STATUS_CD = #{1}
		WHERE PJ_KEY = #{0}
	</update>
	
	<insert id="insertBasicInfo" parameterType="projectVO">
		INSERT INTO PJ_MAIN_TB (
			PJ_KEY
			, AC_KEY
			, AC_DIRECTOR_KEY
			, PJ_NM
			, PJ_START_DT
			, PJ_END_DT
			, PJ_SALE_EMP_KEY
			, PJ_SUPPORT_EMP_KEY
			, REMARK
			, DELETE_YN
			, REG_DT
			, REG_EMP_KEY
			, REG_TM
			, SP_KEY
			, PJ_STATUS_CD
		) VALUES (
			#{pjKey}
			, #{acKey}
			, #{acDirectorKey}
			, #{pjNm}
			, #{pjStartDt}
			, #{pjEndDt}
			, #{pjSaleEmpKey}
			, #{pjSupportEmpKey}
			, #{remark}
			, 'N'
			, DATE_FORMAT(NOW(),'%Y%m%d')
			, #{regEmpKey}
			, DATE_FORMAT(NOW(),'%H%i%s')
			, #{spKey}
			, 'PJST1000'
		)
	</insert>
	
	<update id="updateBasicInfo" parameterType="projectVO">
		UPDATE PJ_MAIN_TB 
		SET	
			<if test="acKey != null and acKey != ''">
				AC_KEY = #{acKey},
			</if>
			<if test="acDirectorKey != null and acDirectorKey != ''">
				AC_DIRECTOR_KEY = #{acDirectorKey},
			</if>
			<if test="pjNm != null and pjNm != ''">
				PJ_NM = #{pjNm},
			</if>
			<if test="pjStartDt != null and pjStartDt != ''">
				PJ_START_DT = #{pjStartDt},
			</if>
			<if test="pjEndDt != null and pjEndDt != ''">
				PJ_END_DT = #{pjEndDt},
			</if>
			<if test="pjSaleEmpKey != null and pjSaleEmpKey != ''">
				PJ_SALE_EMP_KEY = #{pjSaleEmpKey},
			</if>
			<if test="pjSupportEmpKey != null and pjSupportEmpKey != ''">
				PJ_SUPPORT_EMP_KEY = #{pjSupportEmpKey},
			</if>
			<if test="remark != null and remark != ''">
				REMARK = #{remark},
			</if>
			<if test="pjInspectDt != null and pjInspectDt != ''">
				PJ_INSPECT_DT = #{pjInspectDt},
			</if>
			<if test="finishRemark != null and finishRemark != ''">
				FINISH_REMARK = #{finishRemark},
			</if>
			<if test="spKey != null and spKey != ''">
				SP_KEY = #{spKey},
			</if>
			<if test="pjStatusCd != null and pjStatusCd != ''">
				PJ_STATUS_CD = #{pjStatusCd},
			</if>
			<if test="pjSjYn != null and pjSjYn != ''">
				PJ_SJ_YN = 'N',
			</if>
			<if test="pjLoseCause != null and pjLoseCause != ''" >
				PJ_LOSE_CAUSE = #{pjLoseCause},
			</if>
			MOD_DT = DATE_FORMAT(NOW(),'%Y%m%d')
			, MOD_TM = DATE_FORMAT(NOW(),'%H%i%s')
			, MOD_EMP_KEY = #{modEmpKey}
		WHERE PJ_KEY = #{pjKey}
			AND DELETE_YN = 'N'
	</update>
	
	<update id="deleteProject" parameterType="projectVO">
		
	</update>
	
	<!-- <select id="selectBiddingDetail" parameterType="projectVO" resultType="com.cmm.mybatis.CamelCaseMap">
		SELECT 
			PJ_NM
			, M.AC_KEY
			, M.PJ_SALE_EMP_KEY
			, M.PJ_SUPPORT_EMP_KEY
			, M.PJ_START_DT
			, M.PJ_END_DT
			, B.BD_LIMIT_DT
			, B.BD_PROPOSAL_YN
			, B.BD_PROPOSAL_DUE_DT
			, B.BD_PROPOSAL_PRESENT_YN
			, B.BD_PROPOSAL_PRESENT_DT
		FROM PJ_MAIN_TB M
		LEFT OUTER JOIN PJ_BIDDING_TB B
		ON M.PJ_KEY = B.PJ_KEY
		WHERE M.PJ_KEY = #{pjKey}
		AND B.DELETE_YN = 'N'
	</select> -->
	
	<select id="selectBiddingDetail" parameterType="projectBiddingVO" resultType="projectBiddingVO">
		SELECT 
			BD_KEY AS bdKey
			, PJ_KEY AS pjKey
			, BD_GB_YN AS bdGbYn
			, BD_GB_START_DT AS bdGbStartDt
			, BD_GB_END_DT AS bdGbEndDt
			, BD_GB_FINISH_DT AS bdGbFinishDt
			, BD_GB_FINISH_YN AS bdGbFinishYn
			, BD_GB_AMOUNT AS bdGbAmount
			, BD_LIMIT_DT AS bdLimitDt
			, BD_LIMIT_TM AS bdLimitTm
			, BD_PROPOSAL_YN AS bdProposalYn
			, BD_PROPOSAL_DUE_DT AS bdProposalDueDt
			, BD_PROPOSAL_DUE_TM AS bdProposalDueTm
			, BD_PROPOSAL_PRESENT_YN AS bdProposalPresentYn
			, BD_PROPOSAL_PRESENT_DT AS bdProposalPresentDt
			, BD_PROPOSAL_PRESENT_TM AS bdProposalPresentTm
		FROM PJ_BIDDING_TB 
		WHERE PJ_KEY = #{pjKey}
		AND DELETE_YN = 'N'
	</select>
	
	<select id="selectBiddingFileList" parameterType="projectBiddingVO" resultType="egovMap">
		SELECT 
			BD_KEY 
			, BD_SEQ 
			, BD_FILE_KIND_CD
			, BD_DOC_CNT
			, BD_FILE_DOC_NM
		FROM PJ_BIDDING_FILE_INFO_TB 
		WHERE BD_KEY = #{bdKey}
		AND DELETE_YN='N'
	</select>
	
	<insert id="insertBiddingInfo" parameterType="projectBiddingVO">
		INSERT INTO PJ_BIDDING_TB (
			BD_KEY
			, PJ_KEY
			, BD_GB_YN
			<if test="bdGbStartDt != null and bdGbStartDt != ''">
			, BD_GB_START_DT
			</if>
			<if test="bdGbEndDt != null and bdGbEndDt != ''">
			, BD_GB_END_DT
			</if>
			<if test="bdGbFinishDt != null and bdGbFinishDt != ''">
			, BD_GB_FINISH_DT
			</if>
			<if test="bdGbAmount != null and bdGbAmount != '' and bdGbAmount != 0">
			, BD_GB_AMOUNT
			</if>
			, BD_GB_FINISH_YN
			, BD_LIMIT_DT
			<if test="bdLimitTm != null and bdLimitTm != ''">
			, BD_LIMIT_TM
			</if>
			, BD_PROPOSAL_YN
			<if test="bdProposalDueDt != null and bdProposalDueDt != ''">
			, BD_PROPOSAL_DUE_DT
			</if>
			<if test="bdProposalDueTm != null and bdProposalDueTm != ''">
			, BD_PROPOSAL_DUE_TM
			</if>
			, BD_PROPOSAL_PRESENT_YN
			<if test="bdProposalPresentDt != null and bdProposalPresentDt != ''">
			, BD_PROPOSAL_PRESENT_DT
			</if>
			<if test="bdProposalPresentTm != null and bdProposalPresentTm != ''">
			, BD_PROPOSAL_PRESENT_TM
			</if>
			, REG_DT
			, REG_TM
			, REG_EMP_KEY
			, DELETE_YN
		) VALUES (
			#{bdKey}
			, #{pjKey}
			, #{bdGbYn}
			<if test="bdGbStartDt != null and bdGbStartDt != ''">
			, #{bdGbStartDt}
			</if>
			<if test="bdGbEndDt != null and bdGbEndDt != ''">
			, #{bdGbEndDt}
			</if>
			<if test="bdGbFinishDt != null and bdGbFinishDt != ''">
			, #{bdGbFinishDt}
			</if>
			<if test="bdGbAmount != null and bdGbAmount != '' and bdGbAmount != 0">
			, #{bdGbAmount}
			</if>
			, #{bdGbFinishYn}
			, #{bdLimitDt}
			<if test="bdLimitTm != null and bdLimitTm != ''">
			, #{bdLimitTm}
			</if>
			, #{bdProposalYn}
			<if test="bdProposalDueDt != null and bdProposalDueDt != ''">
			, #{bdProposalDueDt}
			</if>
			<if test="bdProposalDueTm != null and bdProposalDueTm != ''">
			, #{bdProposalDueTm}
			</if>
			, #{bdProposalPresentYn}
			<if test="bdProposalPresentDt != null and bdProposalPresentDt != ''">
			, #{bdProposalPresentDt}
			</if>
			<if test="bdProposalPresentTm != null and bdProposalPresentTm != ''">
			, #{bdProposalPresentTm}
			</if>
			, DATE_FORMAT(NOW(),'%Y%m%d')
			, DATE_FORMAT(NOW(), '%H%i%s')
			, #{regEmpKey}
			, 'N'
		)
	</insert>
	
	<update id="updateBiddingInfo" parameterType="projectBiddingVO">
		UPDATE PJ_BIDDING_TB SET
			BD_GB_YN = #{bdGbYn}
			, BD_LIMIT_DT = #{bdLimitDt}
			, BD_PROPOSAL_PRESENT_YN = #{bdProposalPresentYn}
			, BD_PROPOSAL_YN = #{bdProposalYn}
			, BD_GB_FINISH_YN = #{bdGbFinishYn}
			<if test="bdGbAmount != null and bdGbAmount != '' and bdGbAmount != 0">
				, BD_GB_AMOUNT=#{bdGbAmount}
			</if>
			<if test="bdGbStartDt != null and bdGbStartDt != ''">
				, BD_GB_START_DT=#{bdGbStartDt}
			</if>
			<if test="bdGbEndDt != null and bdGbEndDt != ''">
				, BD_GB_END_DT=#{bdGbEndDt}
			</if>
			<if test="bdGbFinishDt != null and bdGbFinishDt != ''">
				, BD_GB_FINISH_DT=#{bdGbFinishDt}
			</if>
			<if test="bdLimitTm != null and bdLimitTm != ''">
				, BD_LIMIT_TM=#{bdLimitTm}
			</if>
			<if test="bdProposalDueDt != null and bdProposalDueDt != ''">
				, BD_PROPOSAL_DUE_DT=#{bdProposalDueDt}
			</if>
			<if test="bdProposalDueTm != null and bdProposalDueTm != ''">
				, BD_PROPOSAL_DUE_TM=#{bdProposalDueTm}
			</if>
			<if test="bdProposalPresentDt != null and bdProposalPresentDt != ''">
				, BD_PROPOSAL_PRESENT_DT=#{bdProposalPresentDt}
			</if>
			<if test="bdProposalPresentTm != null and bdProposalPresentTm != ''">
				, BD_PROPOSAL_PRESENT_TM=#{bdProposalPresentTm}
			</if>
				, MOD_DT=DATE_FORMAT(NOW(),'%Y%m%d')
				, MOD_TM=DATE_FORMAT(NOW(),'%H%i%s')
				, MOD_EMP_KEY=#{modEmpKey}
			WHERE BD_KEY = #{bdKey}
				AND DELETE_YN = 'N'
	</update>
	
	<insert id="insertBiddingFileInfo" parameterType="java.util.Map">
		INSERT INTO PJ_BIDDING_FILE_INFO_TB (
			BD_KEY
			, BD_SEQ
			, BD_FILE_KIND_CD
			, BD_FILE_DOC_NM
			, BD_DOC_CNT
			, DELETE_YN
		) VALUES
		<foreach collection="biddingFileVOList" item="item" separator=",">
			 (
				#{bdKey}
				, (SELECT (SELECT COUNT(*) FROM PJ_BIDDING_FILE_INFO_TB BFI WHERE BFI.BD_KEY=#{bdKey}) + 1)
				, #{item.bdFileKindCd}
				, #{item.bdFileDocNm}
				, #{item.bdDocCnt}
				, 'N'
			)
		</foreach>
	</insert>
	
	<update id="updateBiddingFileInfo" parameterType="java.util.Map">
		<foreach collection="biddingFileVOList" item="item" separator=";" close=";">
			UPDATE PJ_BIDDING_FILE_INFO_TB SET
				BD_DOC_CNT = #{item.bdDocCnt}
				<if test="item.bdDocCnt == 0">
				, DELETE_YN='Y'
				</if>
			WHERE 
				BD_KEY = #{bdKey}
				AND BD_SEQ = #{item.bdSeq}
		</foreach>
	</update>
	
	<insert id="insertContractInfo" parameterType="projectContractSalesVO">
		INSERT INTO PJ_CONTRACT_TB (
			CT_KEY
			, PJ_KEY
			, CT_AMOUNT
			, TAX_YN
			, COLLECT_TURN
			, CT_DT
			, CT_PAY_TERMS
			, REG_DT
			, REG_TM
			, REG_EMP_KEY
			, DELETE_YN
		) VALUES (
			#{ctKey}
			, #{pjKey}
			, #{ctAmount}
			, #{taxYn}
			, #{collectTurn}
			, #{ctDt}
			, #{ctPayTerms}
			, DATE_FORMAT(NOW(),'%Y%m%d')
			, DATE_FORMAT(NOW(),'%H%i%s')
			, #{regEmpKey}
			, 'N'
		)
	</insert>
	
	<select id="selectSalesList" parameterType="String" resultType="egovMap">
		SELECT 
			SD.SALES_KEY
			, SD.SALES_CHARGE_DT
			, SD.SALES_TURN
			, SD.SALES_COLLECT_RATE
			, SD.SALES_TURN_AMOUNT
			, SD.SALES_COLLECT_FC_DT
			, SD.SALES_COLLECT_FINISH_DT
			, SD.SALES_BILL_FC_DT
			, (SELECT CA.AC_NM FROM CMM_ACCOUNT_TB CA, PJ_MAIN_TB PJ WHERE CA.AC_KEY = PJ.AC_KEY AND PJ.PJ_KEY = #{pjKey}) AS AC_NM
			, SB.BILL_ISSUE_DT
		FROM PJ_SALES_DETAIL_TB SD 
		LEFT OUTER JOIN (
			SELECT BILL_CT_FK_KEY, BILL_ISSUE_DT
			FROM PJ_SD_BILLING_TB
			WHERE DELETE_YN='N'
			GROUP BY BILL_CT_FK_KEY
		) AS SB ON (SD.SALES_KEY = SB.BILL_CT_FK_KEY )
		WHERE SD.SALES_CT_FK_KEY=#{pjKey}
		AND SD.DELETE_YN='N';
	</select>
	
	<!-- <select id="selectSalesList" parameterType="String" resultType="egovMap">
		SELECT 
			BL.BILL_ISSUE_DT
			, PS.SALES_CHARGE_DT
			, AC.AC_NM
			, PS.SALES_TURN
			, PS.SALES_COLLECT_RATE
			, PS.SALES_TURN_AMOUNT
			, PS.SALES_COLLECT_FC_DT
			, PS.SALES_COLLECT_FINISH_DT
		FROM CMM_SALES_DETAIL_TB PS
		JOIN CMM_BILLING_TB BL
		ON PS.SALES_KEY = BL.BILL_CT_FK_KEY
		JOIN CMM_ACCOUNT_TB AC
		ON AC.AC_KEY = BL.BILL_AC_KEY
		WHERE PS.SALES_CT_FK_KEY=#{pjKey}
		AND PS.DELETE_YN='N'
		AND BL.DELETE_YN='N'
	</select> -->
	
	<insert id="insertSalesInfo" parameterType="java.util.Map">
		INSERT INTO PJ_SALES_DETAIL_TB (
			SALES_KEY
			, SALES_CT_FK_KEY
			, SALES_TURN
			, SALES_COLLECT_RATE
			, SALES_TURN_AMOUNT
			, SALES_CHARGE_DT
			, SALES_BILL_FC_DT
			, SALES_COLLECT_FC_DT
			, SALES_COLLECT_FINISH_DT
			, SALES_GB_YN
			, SALES_STATUS_CD
			, REG_DT
			, REG_TM
			, REG_EMP_KEY
			, DELETE_YN
		) VALUES 
		<foreach collection="SalesVOList" item="item" separator=",">
			(
				#{item.salesKey}
				, #{salesCtFkKey}
				, #{item.salesTurn}
				, #{item.salesCollectRate}
				, #{item.salesTurnAmount}
				, #{item.salesChargeDt}
				, #{item.salesBillFcDt}
				, #{item.salesCollectFcDt}
				, #{item.salesCollectFinishDt}
				, #{item.salesGbYn}
				, #{item.salesStatusCd}
				, DATE_FORMAT(NOW(),'%Y%m%d')
				, DATE_FORMAT(NOW(),'%H%i%s')
				, #{regEmpKey}
				, 'N'
			)
		</foreach>
	</insert>
	
	<select id="selectPurchaseList" parameterType="String" resultType="egovMap">
		SELECT
			OP.ORDER_UPRICE
			, OP.ORDER_QUANTITY
			, OD.ORDER_AMOUNT
			, AC.AC_NM
			, BL.BILL_MAPPING_YN
			, BL.BILL_ISSUE_DT
			, BL.BILL_NO
			, PC.BUY_KEY
			, (SELECT CC.AC_NM FROM CMM_ACCOUNT_TB CC WHERE PP.MF_AC_KEY = CC.AC_KEY) AS MF_AC_NM
		FROM 
			PJ_ORDER_TB OD, 
			PJ_ORDER_PRODUCT_TB OP,
			CMM_ACCOUNT_TB AC,
			PJ_PURCHASE_TB PC,
			PJ_PC_BILLING_TB BL,
			PM_PRODUCT_MNG_TB PP
		WHERE OD.PJ_ORDER_KEY = OP.PJ_ORDER_KEY
			AND OD.ORDER_AC_KEY = AC.AC_KEY
			AND OD.PJ_ORDER_KEY = PC.BUY_ORDER_FK_KEY
			AND PC.BUY_KEY = BL.BILL_CT_FK_KEY
			AND OP.ORDER_PM_FK_KEY = PP.PM_KEY
			AND OD.ORDER_CT_FK_KEY=#{pjKey}
			AND OD.DELETE_YN='N'
			AND PC.DELETE_YN='N'
	</select>
	
	<update id="updateContractInfo" parameterType="projectContractSalesVO">
		<!-- <foreach collection="projectContractSalesVOList" item="item" separator=";" close=";"> -->
			UPDATE PJ_CONTRACT_TB SET
				CT_AMOUNT = #{ctAmount}
				, CT_PAY_TERMS = #{ctPayTerms}
				, CT_DT = #{ctDt}
				, TAX_YN=#{taxYn}
				, COLLECT_TURN = #{collectTurn}
				, MOD_DT = DATE_FORMAT(NOW(),'%Y%m%d')
				, MOD_TM = DATE_FORMAT(NOW(),'%H%i%s')
				, MOD_EMP_KEY = #{modEmpKey}
			WHERE CT_KEY=#{ctKey}
		<!-- </foreach> -->
	</update>
	
	<update id="updateSalesInfo" parameterType="projectContractSalesVO">
		<foreach collection="projectContractSalesVOList" item="item" separator=";" close=";">
			UPDATE PJ_SALES_DETAIL_TB SET
			<if test="item.salesCollectRate != null and item.salesCollectRate != '' and item.salesCollectRate != 0">
				SALES_COLLECT_RATE=#{item.salesCollectRate},
			</if>
			<if test="item.salesTurnAmount != null and item.salesTurnAmount != '' and item.salesTurnAmount != 0">
				SALES_TURN_AMOUNT=#{item.salesTurnAmount},
			</if>
			<if test="item.salesChargeDt != null and item.salesChargeDt != ''">
				SALES_CHARGE_DT=#{item.salesChargeDt},
			</if>
			<if test="item.salesBillFcDt != null and item.salesBillFcDt != ''"> 
				SALES_BILL_FC_DT=#{item.salesBillFcDt},
			</if> 
			<if test="item.salesCollectFcDt != null and item.salesCollectFcDt != ''"> 
				SALES_COLLECT_FC_DT=#{item.salesCollectFcDt},
			</if>
			<if test="item.salesCollectFinishDt != null and item.salesCollectFinishDt != ''">
				SALES_COLLECT_FINISH_DT=#{item.salesCollectFinishDt},
			</if>
			<if test="item.salesGbYn != null and item.salesGbYn != ''">
				SALES_GB_YN=#{item.salesGbYn},
			</if>
			<if test="item.salesStatusCd != null and item.salesStatusCd != ''">
				SALES_STATUS_CD=#{item.salesStatusCd},
			</if>
				MOD_DT=DATE_FORMAT(NOW(),'%Y%m%d'),
				MOD_TM=DATE_FORMAT(NOW(),'%H%i%s'),
				MOD_EMP_KEY=#{modEmpKey}
			WHERE SALES_KEY = #{item.salesKey}
				AND DELETE_YN = 'N'
		</foreach>
	</update>
	
	<select id="selectContractDetail" parameterType="String" resultType="projectContractVO">
		SELECT 
			CT_KEY AS ctKey
			, CT_AMOUNT AS ctAmount
			, CT_DT AS ctDt
			, CT_PAY_TERMS AS ctPayTerms
			, TAX_YN AS taxYn
			, COLLECT_TURN AS collectTurn
		FROM PJ_CONTRACT_TB 
		WHERE PJ_KEY=#{pjKey}
		AND DELETE_YN='N'
	</select>
	
	<select id="selectGuarantyList" parameterType="String" resultType="egovMap">
		SELECT 
			GB.GB_KEY
			, GB.GB_KIND_CD
			, GB.GB_ISSUE_YN
			, GB.GB_PUBLISH_DT
			, GB.GB_AMOUNT
			, GB.SALES_KEY
			, GB.GB_START_DT
			, GB.GB_END_DT
		FROM PJ_GUARANTY_BOND_TB GB
		JOIN PJ_SALES_DETAIL_TB  SD
		ON GB.SALES_KEY = SD.SALES_KEY
		WHERE SD.SALES_CT_FK_KEY=#{pjKey}
		AND GB.DELETE_YN='N'
		ORDER BY SALES_KEY ASC, GB_KIND_CD ASC
	</select>
	
	<insert id="insertGuarantyInfo" parameterType="guarantyBondVO">
		INSERT INTO PJ_GUARANTY_BOND_TB (
			GB_KEY
			, CT_KEY
			, SALES_KEY
			, GB_KIND_CD
			, GB_START_DT
			, GB_END_DT
			, GB_ISSUE_YN
			, GB_PUBLISH_DT
			, GB_AMOUNT
			, DELETE_YN
		) VALUES (
			#{gbKey}
			, #{ctKey}
			, #{salesKey}
			, #{gbKindCd} 
			, #{gbStartDt}
			, #{gbEndDt}
			, #{gbIssueYn}
			, #{gbPublishDt}
			, #{gbAmount}
			, 'N'
		)
	</insert>
	
	<update id="updateGuarantyInfo" parameterType="guarantyBondVO">
		UPDATE PJ_GUARANTY_BOND_TB SET
			GB_START_DT = #{gbStartDt}
			, GB_END_DT = #{gbEndDt}
			, GB_ISSUE_YN = #{gbIssueYn}
			, GB_AMOUNT = #{gbAmount}
			, GB_PUBLISH_DT = #{gbPublishDt}
		WHERE GB_KEY=#{gbKey}
	</update>
	
	<update id="deleteGuarantyInfo" parameterType="guarantyBondVO">
		UPDATE PJ_GUARANTY_BOND_TB SET
			DELETE_YN='Y'
		WHERE GB_KEY=#{gbKey}
	</update>
	
	<select id="selectOrderInfo" parameterType="orderVO" resultType="egovMap">
		SELECT *  
		FROM CMM_ORDER_TB 
		WHERE ORDER_CT_FK_KEY = #{pjKey}
		AND DELETE_YN='N'
	</select>
	
	<insert id="insertOrderInfo" parameterType="projectOrderVO">
		INSERT INTO PJ_ORDER_TB (
			PJ_ORDER_KEY
			, ORDER_CT_FK_KEY
			, ORDER_DT
			, ORDER_AC_KEY
			, ORDER_AC_DIRECTOR_KEY
			, ORDER_PAY_TERMS
			, ORDER_AMOUNT
			, TAX_YN
			, REG_DT
			, REG_TM
			, REG_EMP_KEY
			, DELETE_YN
		) VALUES (
			#{pjOrderKey} 
			, #{orderCtFkKey}
			, #{orderDt}
			, #{orderAcKey}
			, #{orderAcDirectorKey}
			, #{orderPayTerms}
			, #{orderAmount}
			, #{taxYn}
			, DATE_FORMAT(NOW(),'%Y%m%d')
			, DATE_FORMAT(NOW(),'%H%i%s')
			, #{regEmpKey}
			, 'N'
		)
	</insert>
	
	<update id="updateOrderInfo" parameterType="projectOrderVO">
		UPDATE PJ_ORDER_TB
		SET
			ORDER_CT_FK_KEY = #{orderCtFkKey}
			, ORDER_DT = #{orderDt}
			, ORDER_AC_KEY = #{orderAcKey}
			, ORDER_AC_DIRECTOR_KEY = #{orderAcDirectorKey}
			, ORDER_PAY_TERMS = #{orderPayTerms}
			, ORDER_AMOUNT = #{orderAmount}
			, TAX_YN = #{taxYn}
			, MOD_DT = DATE_FORMAT(NOW(),'%Y%m%d')
			, MOD_TM = DATE_FORMAT(NOW(),'%H%i%s')
			, MOD_EMP_KEY = #{modEmpKey}
		WHERE PJ_ORDER_KEY = #{pjOrderKey}	
	</update>
	
	<insert id="insertOrderProductInfo" parameterType="java.util.Map">
		INSERT INTO PJ_ORDER_PRODUCT_TB (
			PJ_ORDER_KEY
			, ORDER_SEQ
			, ORDER_PM_FK_KEY
			, ORDER_QUANTITY
			, ORDER_UPRICE
			, ORDER_RECEIPT_DT
			, MT_RATE
			, FREE_MT_START_DT
			, FREE_MT_END_DT
			, REG_DT
			, REG_TM
			, REG_EMP_KEY
			, DELETE_YN
		) VALUES 
		<foreach collection="orderProductVOList" item="item" separator=",">
		    (
			#{pjOrderKey}
			, (SELECT IFNULL(MAX(OP.ORDER_SEQ) + 1, 1) FROM PJ_ORDER_PRODUCT_TB OP WHERE OP.PJ_ORDER_KEY=#{pjOrderKey})
			, #{item.orderPmFkKey}
			, #{item.orderQuantity}
			, #{item.orderUprice}
			, #{item.orderReceiptDt}
			, #{item.mtRate}
			, #{item.freeMtStartDt}
			, #{item.freeMtEndDt}
			, DATE_FORMAT(NOW(),'%Y%m%d')
		    , DATE_FORMAT(NOW(),'%H%i%s')
		    , #{regEmpKey}
			, 'N'
			)
		</foreach>
	</insert>
	
	<update id="updateOrderProductInfo" parameterType="java.util.HashMap">
		<foreach collection="orderProductVOList" item="item" separator=";" close=";">
			UPDATE PJ_ORDER_PRODUCT_TB
			SET ORDER_PM_FK_KEY=#{item.orderPmFkKey} 
				, ORDER_QUANTITY = #{item.orderQuantity}
				, ORDER_UPRICE = #{item.orderUprice}
				, ORDER_RECEIPT_DT = #{item.orderReceiptDt}
				, MT_RATE = #{item.mtRate}
				, FREE_MT_START_DT = #{item.freeMtStartDt}
				, FREE_MT_END_DT = #{item.freeMtEndDt}
				, MOD_DT = DATE_FORMAT(NOW(),'%Y%m%d')
				, MOD_TM = DATE_FORMAT(NOW(),'%H%i%s') 
				, MOD_EMP_KEY = #{modEmpKey}
			WHERE PJ_ORDER_KEY = #{item.pjOrderKey}
				AND ORDER_SEQ = #{item.orderSeq}
		</foreach>
	</update>
	
	<update id="deleteOrderProductInfo" parameterType="java.util.HashMap">
		UPDATE PJ_ORDER_PRODUCT_TB
		SET 
			DELETE_YN = 'Y'
			, MOD_DT = DATE_FORMAT(NOW(),'%Y%m%d')
			, MOD_TM = DATE_FORMAT(NOW(),'%H%i%s') 
			, MOD_EMP_KEY = #{modEmpKey}
		WHERE PJ_ORDER_KEY = #{pjOrderKey}
			AND ORDER_SEQ IN
			<foreach collection="deleteKeyList" item="item" index="index" separator="," open="(" close=")">
				#{item}
			</foreach>
	</update>
	
	<select id="selectOrderSelectBoxList" parameterType="String" resultType="egovMap">
		SELECT
			PO.PJ_ORDER_KEY
			, PO.ORDER_AC_KEY
			, CA.AC_NM
		FROM PJ_ORDER_TB PO, CMM_ACCOUNT_TB CA
		WHERE PO.ORDER_CT_FK_KEY=#{key}
			AND PO.DELETE_YN='N'
			AND PO.ORDER_AC_KEY = CA.AC_KEY
	</select>
	
	<select id="selectOrderDetail" parameterType="String" resultType="projectOrderVO">
		SELECT
			PJ_ORDER_KEY AS pjOrderKey
			, ORDER_DT AS orderDt
			, ORDER_AC_KEY AS orderAcKey
			, (SELECT A.AC_NM FROM CMM_ACCOUNT_TB A WHERE A.AC_KEY = PO.ORDER_AC_KEY ) AS orderAcNm
			, ORDER_AC_DIRECTOR_KEY AS orderAcDirectorKey
			, (SELECT AD.AC_DIRECTOR_NM FROM CMM_ACCOUNT_DIRECTOR_TB AD WHERE AD.AC_DIRECTOR_KEY = PO.ORDER_AC_DIRECTOR_KEY ) AS orderAcDirectorNm
			, (SELECT AD.AC_DIRECTOR_MB_NUM FROM CMM_ACCOUNT_DIRECTOR_TB AD WHERE AD.AC_DIRECTOR_KEY = PO.ORDER_AC_DIRECTOR_KEY) AS orderAcDirectorMbNum
			, (SELECT PJ.PJ_NM  FROM PJ_MAIN_TB PJ, PJ_ORDER_TB PO WHERE PJ.PJ_KEY=PO.ORDER_CT_FK_KEY AND PO.PJ_ORDER_KEY=#{orderKey}) AS pjNm
			, (SELECT CA.AC_NM FROM PJ_MAIN_TB PJ, PJ_ORDER_TB PO, CMM_ACCOUNT_TB CA WHERE PJ.PJ_KEY=PO.ORDER_CT_FK_KEY AND PJ.AC_KEY = CA.AC_KEY AND PO.PJ_ORDER_KEY=#{orderKey}) AS acNm
			, ORDER_PAY_TERMS AS orderPayTerms
			, ORDER_AMOUNT AS orderAmount
			, TAX_YN AS taxYn
		FROM PJ_ORDER_TB PO
		WHERE PJ_ORDER_KEY = #{orderKey}
			AND DELETE_YN='N'
	</select>
	
	<select id="selectPurchaseDetail" parameterType="projectPurchaseVO" resultType="projectPurchaseVO">
		SELECT 
			BUY_KEY AS buyKey
			, BUY_FK_PJ_KEY AS buyFkPjKey
			, BUY_ORDER_FK_KEY AS buyOrderFkKey
			, BUY_AMOUNT AS buyAmount
			, DONE_PAYMENT_AMOUNT AS donePaymentAmount
			, YET_PAYMENT_AMOUNT AS yetPaymentAmount
			, BUY_TURN buyTurn
		FROM PJ_PURCHASE_TB
		WHERE DELETE_YN='N'
		<if test="buyKey != null and buyKey != ''">
			AND BUY_KEY = #{buyKey}
		</if>
		<if test="buyOrderFkKey != null and buyOrderFkKey != ''">
			AND BUY_ORDER_FK_KEY = #{buyOrderFkKey}
		</if>
			
	</select>
	
	<select id="selectOrderProductList" parameterType="String" resultType="projectOrderProductVO">
		SELECT
			OP.PJ_ORDER_KEY AS pjOrderKey
			, OP.ORDER_SEQ AS orderSeq
			, OP.ORDER_PM_FK_KEY AS orderPmFkKey
			, OP.ORDER_QUANTITY AS orderQuantity
			, OP.ORDER_UPRICE AS orderUprice
			, OP.ORDER_RECEIPT_DT AS orderReceiptDt
			, OP.MT_RATE AS mtRate
			, OP.FREE_MT_START_DT AS freeMtStartDt
			, OP.FREE_MT_END_DT AS freeMtEndDt
			, PM.PM_NM_CD AS pmNmCd
		FROM PJ_ORDER_PRODUCT_TB OP, PM_PRODUCT_MNG_TB PM
		WHERE OP.PJ_ORDER_KEY = #{orderKey}
			AND OP.DELETE_YN='N'
			AND OP.ORDER_PM_FK_KEY = PM.PM_KEY
	</select>
	
	<update id="deleteOrderInfo" parameterType="projectOrderVO">
		UPDATE PJ_ORDER_TB
		SET
			DELETE_YN='Y'
			, MOD_DT = DATE_FORMAT(NOW(),'%Y%m%d')
			, MOD_TM = DATE_FORMAT(NOW(),'%H%i%s') 
			, MOD_EMP_KEY = #{modEmpKey}
		WHERE PJ_ORDER_KEY = #{pjOrderKey}
	</update>
	
	<update id="deleteOrderProductAll" parameterType="java.util.HashMap">
		UPDATE PJ_ORDER_PRODUCT_TB
		SET
			DELETE_YN='Y'
			, MOD_DT = DATE_FORMAT(NOW(),'%Y%m%d')
			, MOD_TM = DATE_FORMAT(NOW(),'%H%i%s') 
			, MOD_EMP_KEY = #{modEmpKey}
		WHERE PJ_ORDER_KEY = #{pjOrderKey}
	</update>
	
	<insert id="insertPurchaseInfo" parameterType="projectPurchaseVO">
		INSERT INTO PJ_PURCHASE_TB (
			BUY_KEY
			, BUY_FK_PJ_KEY
			, BUY_ORDER_FK_KEY
			, BUY_AMOUNT
			, DONE_PAYMENT_AMOUNT
			, YET_PAYMENT_AMOUNT
			, BUY_TURN
			, REG_DT
			, REG_TM
			, REG_EMP_KEY
			, DELETE_YN
		) VALUES (
			#{buyKey}
			, #{buyFkPjKey}
			, #{buyOrderFkKey}
			, #{buyAmount}
			, #{donePaymentAmount}
			, #{yetPaymentAmount}
			, #{buyTurn}
			, DATE_FORMAT(NOW(),'%Y%m%d')
			, DATE_FORMAT(NOW(),'%H%i%s')
			, #{regEmpKey}
			, 'N'
		) 
	</insert>
	
	<update id="updatePurchaseInfo" parameterType="projectPurchaseVO">
		UPDATE PJ_PURCHASE_TB SET
			MOD_DT = DATE_FORMAT(NOW(),'%Y%m%d')
			, MOD_TM = DATE_FORMAT(NOW(),'%H%i%s')
			, MOD_EMP_KEY = #{modEmpKey}
			<if test="buyAmount != null and buyAmount != '' and buyAmount != 0">
			, BUY_AMOUNT = #{buyAmount}
			</if>
			<if test="donePaymentAmount != null and donePaymentAmount != '' and donePaymentAmount != 0">
			, DONE_PAYMENT_AMOUNT = #{donePaymentAmount}
			</if>
			<if test="yetPaymentAmount != null and yetPaymentAmount != '' and yetPaymentAmount != 0">
			, YET_PAYMENT_AMOUNT = #{yetPaymentAmount}
			</if>
			<if test="buyTurn != null and buyTurn != '' and buyTurn != 0">
			, BUY_TURN = #{buyTurn}
			</if>
		WHERE BUY_KEY = #{buyKey}
	</update>
	
	<update id="deletePurchaseInfo" parameterType="projectPurchaseVO">
		UPDATE PJ_PURCHASE_TB 
		SET
			DELETE_YN='Y'
			, MOD_DT=DATE_FORMAT(NOW(),'%Y%m%d')
			, MOD_TM=DATE_FORMAT(NOW(),'%H%i%s')
			, MOD_EMP_KEY=#{modEmpKey}
		WHERE BUY_KEY = #{buyKey}
	</update>
	
	<update id="deletePaymentAllInfo" parameterType="projectPaymentVO">
		UPDATE PJ_PAYMENT_TB 
		SET
			DELETE_YN='Y'
			, MOD_DT=DATE_FORMAT(NOW(),'%Y%m%d')
			, MOD_TM=DATE_FORMAT(NOW(),'%H%i%s')
			, MOD_EMP_KEY=#{modEmpKey}
		WHERE PAYMENT_BUY_FK_KEY = #{paymentBuyFkKey}
	</update>
	
	<select id="selectAcDirector" parameterType="Integer" resultType="egovMap">			
			SELECT AC_DIRECTOR_KEY
				, CONCAT(AC_DIRECTOR_NM, AC_DIRECTOR_POSITION_NM , ' / ' , AC_DIRECTOR_MB_NUM) AS AC_DIRECTOR_INFO
			FROM CMM_ACCOUNT_DIRECTOR_TB
			WHERE AC_DIRECTOR_KEY = #{acDirectorKey}
	</select>
	
	<select id="selectAcDirectorList" parameterType="String" resultType="egovMap">			
			SELECT AC_DIRECTOR_KEY
				, AC_DIRECTOR_NM
				, CONCAT(AC_DIRECTOR_POSITION_NM , ' / ' , AC_DIRECTOR_MB_NUM , ' / ' , AC_DIRECTOR_EMAIL) AS AC_DIRECTOR_INFO
			FROM CMM_ACCOUNT_DIRECTOR_TB
			WHERE AC_KEY = #{acKey}
			ORDER BY AC_DIRECTOR_NM		
	</select>
	
	<select id="selectFileList" parameterType="projectVO" resultType="com.cmm.mybatis.CamelCaseMap">
		SELECT
			FF.FILE_KEY
			, FF.FILE_ORG_NM
		FROM FM_FILE_MNG_TB FF
		JOIN FM_DOCTYPE_MNG_TB FD
		ON FD.DOC_TYPE_KEY = FF.DOC_TYPE_KEY
		WHERE FD.DOC_UP_TYPE_CD LIKE 'PJBD000%'
	</select>
	
	<insert id="insertBuildInfo" parameterType="projectBuildVO" useGeneratedKeys="true" keyProperty="inbSeq">
		INSERT INTO PJ_INSTALL_AND_BUILD_TB (
			PJ_KEY
			<if test="inbPlace != null and inbPlace != ''">
			, INB_PLACE
			</if>
			, INB_CLASS
			, INB_PM_KEY
			, INB_PM_SERIAL_NO
			, INB_DELIVERY_DT
			<if test="inbPmVer != null and inbPmVer != ''">
			, INB_PM_VER
			</if>
			<if test="inbSpecInfo != null and inbSpecInfo != ''">
			, INB_SPEC_INFO
			</if>
			<if test="inbCacheMem != null and inbCacheMem != '' and inbCacheMem != 0">
			, INB_CACHE_MEM
			</if>
			<if test="inbPortInfo != null and inbPortInfo != ''">
			, INB_PORT_INFO
			</if>
			<if test="inbMngIp != null and inbMngIp != ''">
			, INB_MNG_IP
			</if>
			<if test="remark != null and remark != ''">
			, REMARK
			</if>
			, INB_PM_TYPE
			, REG_DT
			, REG_TM
			, REG_EMP_KEY
			, DELETE_YN
		) VALUES (
			#{pjKey}
			<if test="inbPlace != null and inbPlace != ''">
			, #{inbPlace}
			</if>
			, #{inbClass}
			, #{inbPmKey}
			, #{inbPmSerialNo}
			, #{inbDeliveryDt}
			<if test="inbPmVer != null and inbPmVer != ''">
			, #{inbPmVer}
			</if>
			<if test="inbSpecInfo != null and inbSpecInfo != ''">
			, #{inbSpecInfo}
			</if>
			<if test="inbCacheMem != null and inbCacheMem != '' and inbCacheMem != 0">
			, #{inbCacheMem}
			</if>
			<if test="inbPortInfo != null and inbPortInfo != ''">
			, #{inbPortInfo}
			</if>
			<if test="inbMngIp != null and inbMngIp != ''">
			, #{inbMngIp}
			</if>
			<if test="remark != null and remark != ''">
			, #{remark}
			</if>
			, #{inbPmType}
			, DATE_FORMAT(NOW(),'%Y%m%d')
			, DATE_FORMAT(NOW(),'%H%i%s')
			, #{regEmpKey}
			, 'N'
		)
	</insert>
	
	<update id="updateBuildInfo" parameterType="projectBuildVO">
		UPDATE PJ_INSTALL_AND_BUILD_TB 
		SET
			INB_PM_TYPE = #{inbPmType}
			<if test="inbPlace != null and inbPlace != ''">
			, INB_PLACE = #{inbPlace}
			</if>
			, INB_CLASS = #{inbClass}
			, INB_PM_KEY = #{inbPmKey}
			, INB_PM_SERIAL_NO = #{inbPmSerialNo}
			, INB_DELIVERY_DT = #{inbDeliveryDt}
			<if test="inbPmVer != null and inbPmVer != ''">
			, INB_PM_VER = #{inbPmVer}
			</if>
			<if test="inbSpecInfo != null and inbSpecInfo != ''">
			, INB_SPEC_INFO = #{inbSpecInfo}
			</if>
			<if test="inbCacheMem != null and inbCacheMem != '' and inbCacheMem != 0">
			, INB_CACHE_MEM = #{inbCacheMem}
			</if>
			<if test="inbPortInfo != null and inbPortInfo != ''">
			, INB_PORT_INFO = #{inbPortInfo}
			</if>
			<if test="inbMngIp != null and inbMngIp != ''">
			, INB_MNG_IP = #{inbMngIp}
			</if>
			<if test="remark != null and remark != ''">
			, REMARK = #{remark}
			</if>
			, MOD_DT = DATE_FORMAT(NOW(),'%Y%m%d')
			, MOD_TM = DATE_FORMAT(NOW(),'%H%i%s')
			, MOD_EMP_KEY = #{modEmpKey}
		WHERE PJ_KEY=#{pjKey}
		AND INB_SEQ = #{selectKey}
		AND DELETE_YN='N'
	</update>
	
	<select id="selectBuildDetail" parameterType="projectBuildVO" resultType="egovMap">
		SELECT
			INB.PJ_KEY
			, INB.INB_SEQ
			, INB.INB_PLACE
			, INB.INB_CLASS
			, INB.INB_PM_KEY
			, PM.PM_NM_CD AS inbPmNm
			, INB.INB_PM_SERIAL_NO
			, INB.INB_DELIVERY_DT
			, INB.INB_PM_VER
			, INB.INB_SPEC_INFO
			, INB.INB_CACHE_MEM
			, INB.INB_PORT_INFO
			, INB.INB_MNG_IP
			, INB.INB_PM_TYPE
			, INB.REMARK
		FROM PJ_INSTALL_AND_BUILD_TB INB, PM_PRODUCT_MNG_TB PM
		WHERE PJ_KEY=#{pjKey}
			AND INB.INB_SEQ = #{inbSeq}
			AND INB.INB_PM_KEY = PM.PM_KEY
			AND DELETE_YN = 'N'
	</select>
	
	<insert id="insertWorkInfo" parameterType="projectWorkVO"  useGeneratedKeys="true" keyProperty="pjWorkSeq">
		INSERT INTO PJ_WORK_TB (
			PJ_KEY
			, PJ_WORK_CLASS_CD
			, PJ_WORK_DT
			, PJ_WORK_TM
			, PJ_WORK_TAKE_TM
			, PJ_WORK_NM
			, PJ_WORK_CONT
			, PJ_WORK_RESULT
			, REMARK
			, REG_DT
			, REG_TM
			, REG_EMP_KEY
			, DELETE_YN
		) VALUES (
			#{pjKey}
			, #{pjWorkClassCd}
			, #{pjWorkDt}
			, #{pjWorkTm}
			, #{pjWorkTakeTm}
			, #{pjWorkNm}
			, #{pjWorkCont}
			, #{pjWorkResult}
			, #{remark}
			, DATE_FORMAT(NOW(),'%Y%m%d')
			, DATE_FORMAT(NOW(),'%H%i%s')
			, #{regEmpKey}
			, 'N'
		)
	</insert>
	
	<update id="updateWorkInfo" parameterType="projectWorkVO">
		UPDATE PJ_WORK_TB SET 
			PJ_WORK_CLASS_CD = #{pjWorkClassCd}
			, PJ_WORK_DT = #{pjWorkDt}
			, PJ_WORK_TM = #{pjWorkTm}
			, PJ_WORK_TAKE_TM = #{pjWorkTakeTm}
			, PJ_WORK_NM = #{pjWorkNm}
			, PJ_WORK_CONT = #{pjWorkCont}
			, PJ_WORK_RESULT = #{pjWorkResult}
			, REMARK = #{remark}
			, MOD_DT = DATE_FORMAT(NOW(),'%Y%m%d')
			, MOD_TM = DATE_FORMAT(NOW(),'%H%i%s')
			, MOD_EMP_KEY = #{modEmpKey}
		WHERE PJ_KEY=#{pjKey}
		AND PJ_WORK_SEQ = #{selectKey}
		AND DELETE_YN='N'
	</update>
	
	<select id="selectWorkDetail" parameterType="projectWorkVO" resultType="egovMap">
		SELECT
			PJ_KEY
			, PJ_WORK_SEQ
			, PJ_WORK_CLASS_CD
			, PJ_WORK_DT
			, PJ_WORK_TM
			, PJ_WORK_TAKE_TM
			, PJ_WORK_NM
			, PJ_WORK_CONT
			, PJ_WORK_RESULT
			, REMARK
		FROM PJ_WORK_TB
		WHERE PJ_KEY=#{pjKey}
			AND PJ_WORK_SEQ=#{pjWorkSeq}
			AND DELETE_YN = 'N'
	</select>
</mapper>