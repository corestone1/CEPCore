<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cep.project.service.impl.ProjectMapper">

	<resultMap id="project" type="com.cep.project.vo.ProjectVO">
		<result property="pjKey" column="PJ_KEY"/>
		<result property="acKey" column="AC_KEY"/>
		<result property="pjNm" column="PJ_NM"/>
		<result property="pjStartDt" column="PJ_START_DT"/>
		<result property="pjEndDt" column="PJ_END_DT"/>
		<result property="pjStatusCd" column="PJ_STATUS_CD"/>
		<result property="pjSaleEmpKey" column="PJ_SALE_EMP_KEY"/>
		<result property="bdLimitDt" column="BD_LIMIT_DT" />
		<result property="bdProposalYn" column="BD_PROPOSAL_YN" />
		<result property="bdProposalDueDt" column="BD_PROPOSAL_DUE_DT" />
		<result property="bdProposalPresentYn" column="BD_PROPOSAL_PRESENT_YN" />
		<result property="bdProposalPresentDt" column="BD_PROPOSAL_PRESENT_DT" />
	</resultMap>

	<select id="selectProjectList" parameterType="projectVO" resultType="egovMap">

			SELECT
				PJ_KEY
				, (SELECT a.AC_NM FROM CMM_ACCOUNT_TB a WHERE a.AC_KEY = PJ_MAIN_TB.AC_KEY) AS acKey
				, PJ_NM
				, PJ_START_DT
				, PJ_END_DT
				, PJ_STATUS_CD
				, (SELECT e.EMP_NM FROM CMM_EMPLOYEE_TB e WHERE e.EMP_KEY = PJ_MAIN_TB.PJ_SALE_EMP_KEY) AS pjSaleEmpKey
			FROM PJ_MAIN_TB
			WHERE 1=1
			<!-- <if test="searchKeyword != null and searchKeyword != ''">
		        <choose>
		            <when test="searchCondition == 0">
						AND	PJ_NM LIKE CONCAT('%' , #{pjNm}, '%')
				 	</when>
				</choose> 
			</if> -->
			ORDER BY PJ_KEY ASC
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

	<select id="selectProjectListTotCnt" parameterType="searchVO" resultType="int">

			SELECT COUNT(*)
			FROM PJ_MAIN_TB
			WHERE 1=1
			<!-- <if test="searchKeyword != null and searchKeyword != ''">
		        <choose>
		            <when test="searchCondition == 0">
						AND	USERNAME LIKE CONCAT('%' , #{searchKeyword}, '%')
					</when>
		            <when test="searchCondition == 1">
						AND	TITLE LIKE CONCAT('%' , #{searchKeyword}, '%')
					</when>
				</choose>
			</if> -->
	</select>

	<select id="selectProjectDetail" parameterType="projectVO" resultType="com.cmm.mybatis.CamelCaseMap">
		SELECT 
			PJ_NM
			, M.AC_KEY
			, M.PJ_SALE_EMP_KEY
			, M.PJ_SUPPORT_EMP_KEY
			, M.PJ_START_DT
			, M.PJ_END_DT
			, B.BD_LIMIT_DT
			, B.BD_PROPOSAL_YN
			, B.BD_PROPOSAL_DUE_DT
			, B.BD_PROPOSAL_PRESENT_YN
			, B.BD_PROPOSAL_PRESENT_DT
		FROM PJ_MAIN_TB M
		LEFT OUTER JOIN PJ_BIDDING_TB B
		ON M.PJ_KEY = B.PJ_KEY
		WHERE M.PJ_KEY = #{pjKey}
		AND B.DELETE_YN = 'N'
	</select>
	
	<select id="selectBiddingFile" parameterType="projectVO" resultType="egovMap">
		SELECT
			BD_FILE_DOC_NM
		FROM PJ_BIDDING_FILE_INFO_TB bf
		LEFT OUTER JOIN PJ_MAIN_TB m
		WHERE bf.BD_KEY = m.PJ_KEY
	</select>
</mapper>